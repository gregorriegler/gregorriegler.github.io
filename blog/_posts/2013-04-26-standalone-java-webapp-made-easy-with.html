---
layout: post
title: Standalone Java Webapp made easy with Maven
date: '2013-04-26T21:14:00.001+02:00'
author: Gregor
tags:
- Java
- Standalone
- Tomcat
- Maven
modified_time: '2013-08-03T21:00:55.115+02:00'
blogger_id: tag:blogger.com,1999:blog-1178805312154210159.post-5847334633632894863
blogger_orig_url: http://www.beabetterdeveloper.com/2013/04/standalone-java-webapp-made-easy-with.html
---

<h2>Introduction </h2>As you may already know, creating a war archive and deploying it on a preinstalled Servlet Container is not the only way running a Java webapp, since you can also embed the Web-Server in the application itself. Sometimes such artifacts are delivered as standalone executable programs that can be easily started and stopped in the commandline and even run as a service in the background. Maybe you should also consider producing your app this way and benefit from its huge advantages:<br /><ul><li>No preinstalled Webserver/Servlet Container required that would take additional maintenance.</li><li>Easy Cross-Platform. Same artifact can of course be run on any System.</li><li>Complete Standalone Software </li></ul><a href="http://www.sonarsource.org/">Apache Sonar</a> is a great Example of such Software. It uses an embedded Jetty Server and creates an embedded H2 Database for persistence that can be replaced in configuration. As you can see <a href="http://svn.codehaus.org/sonar/trunk/sonar-application/src/main/assembly/bin/">here</a> they prepared startup scripts for any Platform that execute the actual <a href="http://svn.codehaus.org/sonar/trunk/sonar-application/src/main/java/org/sonar/application/StartServer.java">StartServer</a> class.<br /><h2>Embedded Tomcat</h2>In my tutorial ill use an embedded Tomcat as a Servlet Container. So we want to add the Maven dependencies first.<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: grey;">&lt;!-- embedded Tomcat --&gt;</span><br /><span style="color: #007000;">&lt;dependency&gt;</span><br />    <span style="color: #007000;">&lt;groupId&gt;</span>org.apache.tomcat.embed<span style="color: #007000;">&lt;/groupId&gt;</span><br />    <span style="color: #007000;">&lt;artifactId&gt;</span>tomcat-embed-core<span style="color: #007000;">&lt;/artifactId&gt;</span><br />    <span style="color: #007000;">&lt;version&gt;</span>7.0.37<span style="color: #007000;">&lt;/version&gt;</span><br /><span style="color: #007000;">&lt;/dependency&gt;</span><br /><span style="color: #007000;">&lt;dependency&gt;</span><br />    <span style="color: #007000;">&lt;groupId&gt;</span>org.apache.tomcat.embed<span style="color: #007000;">&lt;/groupId&gt;</span><br />    <span style="color: #007000;">&lt;artifactId&gt;</span>tomcat-embed-logging-log4j<span style="color: #007000;">&lt;/artifactId&gt;</span><br />    <span style="color: #007000;">&lt;version&gt;</span>7.0.37<span style="color: #007000;">&lt;/version&gt;</span><br /><span style="color: #007000;">&lt;/dependency&gt;</span><br /><span style="color: #007000;">&lt;dependency&gt;</span><br />    <span style="color: #007000;">&lt;groupId&gt;</span>org.apache.tomcat.embed<span style="color: #007000;">&lt;/groupId&gt;</span><br />    <span style="color: #007000;">&lt;artifactId&gt;</span>tomcat-embed-jasper<span style="color: #007000;">&lt;/artifactId&gt;</span><br />    <span style="color: #007000;">&lt;version&gt;</span>7.0.37<span style="color: #007000;">&lt;/version&gt;</span><br /><span style="color: #007000;">&lt;/dependency&gt;</span><br /></pre></td></tr></tbody></table></div><br />We can use them now to create a StartServer class<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">final</span> <span style="color: green; font-weight: bold;">class</span> <span style="color: #b00060; font-weight: bold;">StartServer</span> <span style="color: #303030;">{</span><br /><br />    <span style="color: green; font-weight: bold;">private</span> <span style="color: #0060b0; font-weight: bold;">StartServer</span><span style="color: #303030;">()</span> <span style="color: #303030;">{</span><br />    <span style="color: #303030;">}</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">static</span> <span style="color: #303090; font-weight: bold;">void</span> <span style="color: #0060b0; font-weight: bold;">main</span><span style="color: #303030;">(</span>String<span style="color: #303030;">[]</span> args<span style="color: #303030;">)</span> <span style="color: green; font-weight: bold;">throws</span> Exception <span style="color: #303030;">{</span><br />        <br />        <span style="color: grey;">// We will set the basedir Systemproperty accordingly when running the Program</span><br />        <span style="color: grey;">// Actually the mavenplugin appassembler will do this for us</span><br />        String basedir <span style="color: #303030;">=</span> System<span style="color: #303030;">.</span><span style="color: #0000c0;">getProperty</span><span style="color: #303030;">(</span><span style="background-color: #fff0f0;">"basedir"</span><span style="color: #303030;">);</span><br />        String webappLocation <span style="color: #303030;">=</span> <span style="color: green; font-weight: bold;">new</span> File<span style="color: #303030;">(</span>basedir <span style="color: #303030;">+</span> <span style="background-color: #fff0f0;">"/webapp"</span><span style="color: #303030;">).</span><span style="color: #0000c0;">getAbsolutePath</span><span style="color: #303030;">();</span><br />        <span style="color: #303090; font-weight: bold;">int</span> port <span style="color: #303030;">=</span> <span style="color: #0000d0; font-weight: bold;">8080</span><span style="color: #303030;">;</span><br /><br />        Tomcat tomcat <span style="color: #303030;">=</span> <span style="color: green; font-weight: bold;">new</span> Tomcat<span style="color: #303030;">();</span><br />        tomcat<span style="color: #303030;">.</span><span style="color: #0000c0;">setPort</span><span style="color: #303030;">(</span>port<span style="color: #303030;">);</span><br />        tomcat<span style="color: #303030;">.</span><span style="color: #0000c0;">addWebapp</span><span style="color: #303030;">(</span><span style="background-color: #fff0f0;">"/"</span><span style="color: #303030;">,</span> webappLocation<span style="color: #303030;">);</span><br />        tomcat<span style="color: #303030;">.</span><span style="color: #0000c0;">start</span><span style="color: #303030;">();</span><br />        tomcat<span style="color: #303030;">.</span><span style="color: #0000c0;">getServer</span><span style="color: #303030;">().</span><span style="color: #0000c0;">await</span><span style="color: #303030;">();</span><br />    <span style="color: #303030;">}</span><br /><span style="color: #303030;">}</span><br /></pre></td></tr></tbody></table></div><h2>Exploded War</h2>Now we need to make an exploded war in our "target" directory. I choose to create a folder inside "target" that holds the application as a whole including bin files, configuration and the webapp itself. This makes it easy to transport the complete app to another machine.<br /><ul><li>src/... </li><li>target/myapp/bin</li><li>target/myapp/conf</li><li>target/myapp/webapp</li></ul>Ill include the maven-war-plugin to create the exploded war.<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #007000;">&lt;plugin&gt;</span><br />    <span style="color: #007000;">&lt;groupId&gt;</span>org.apache.maven.plugins<span style="color: #007000;">&lt;/groupId&gt;</span><br />    <span style="color: #007000;">&lt;artifactId&gt;</span>maven-war-plugin<span style="color: #007000;">&lt;/artifactId&gt;</span><br />    <span style="color: #007000;">&lt;version&gt;</span>2.3<span style="color: #007000;">&lt;/version&gt;</span><br />    <span style="color: #007000;">&lt;executions&gt;</span><br />        <span style="color: #007000;">&lt;execution&gt;</span><br />            <span style="color: #007000;">&lt;id&gt;</span>war-exploded<span style="color: #007000;">&lt;/id&gt;</span><br />            <span style="color: #007000;">&lt;phase&gt;</span>package<span style="color: #007000;">&lt;/phase&gt;</span><br />            <span style="color: #007000;">&lt;goals&gt;</span><br />                <span style="color: #007000;">&lt;goal&gt;</span>exploded<span style="color: #007000;">&lt;/goal&gt;</span><br />            <span style="color: #007000;">&lt;/goals&gt;</span><br />            <span style="color: #007000;">&lt;configuration&gt;</span><br />                <span style="color: #007000;">&lt;webappDirectory&gt;</span>${project.build.directory}/myapp/webapp<span style="color: #007000;">&lt;/webappDirectory&gt;</span><br />                <span style="color: #007000;">&lt;archiveClasses&gt;</span>true<span style="color: #007000;">&lt;/archiveClasses&gt;</span><br />            <span style="color: #007000;">&lt;/configuration&gt;</span><br />        <span style="color: #007000;">&lt;/execution&gt;</span><br />    <span style="color: #007000;">&lt;/executions&gt;</span><br /><span style="color: #007000;">&lt;/plugin&gt;</span><br /></pre></td></tr></tbody></table></div><br />If you run <i>mvn clean package</i> right now you should get your webapp compiled into <i>target/myapp/webapp</i><br /><h2>Startup Scripts</h2>Finally we need startup Scripts to actually run our application. We need a shell script for unix Systems and a bat file for Windows. The <a href="http://mojo.codehaus.org/appassembler/appassembler-maven-plugin/">Appassembler</a> maven plugin comes in handy here. It is a very thoughtout plugin that creates exactly what we need and even sets the basedir Systemproperty. I'll configure it to use our exploded webapp and StartServer class.<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #007000;">&lt;plugin&gt;</span><br />    <span style="color: #007000;">&lt;groupId&gt;</span>org.codehaus.mojo<span style="color: #007000;">&lt;/groupId&gt;</span><br />    <span style="color: #007000;">&lt;artifactId&gt;</span>appassembler-maven-plugin<span style="color: #007000;">&lt;/artifactId&gt;</span><br />    <span style="color: #007000;">&lt;version&gt;</span>1.3<span style="color: #007000;">&lt;/version&gt;</span><br />    <span style="color: #007000;">&lt;configuration&gt;</span><br />        <span style="color: #007000;">&lt;assembleDirectory&gt;</span>${project.build.directory}/myapp<span style="color: #007000;">&lt;/assembleDirectory&gt;</span><br />        <span style="color: #007000;">&lt;repositoryLayout&gt;</span>flat<span style="color: #007000;">&lt;/repositoryLayout&gt;</span><br />        <span style="color: #007000;">&lt;repositoryName&gt;</span>webapp/WEB-INF/lib<span style="color: #007000;">&lt;/repositoryName&gt;</span><br />        <span style="color: #007000;">&lt;generateRepository&gt;</span>false<span style="color: #007000;">&lt;/generateRepository&gt;</span><br />        <span style="color: #007000;">&lt;copyConfigurationDirectory&gt;</span>true<span style="color: #007000;">&lt;/copyConfigurationDirectory&gt;</span><br />        <span style="color: #007000;">&lt;configurationDirectory&gt;</span>conf<span style="color: #007000;">&lt;/configurationDirectory&gt;</span><br />        <span style="color: #007000;">&lt;programs&gt;</span><br />            <span style="color: #007000;">&lt;program&gt;</span><br />                <span style="color: #007000;">&lt;mainClass&gt;</span>com.myapp.StartServer<span style="color: #007000;">&lt;/mainClass&gt;</span><br />                <span style="color: #007000;">&lt;name&gt;</span>myapp<span style="color: #007000;">&lt;/name&gt;</span><br />            <span style="color: #007000;">&lt;/program&gt;</span><br />        <span style="color: #007000;">&lt;/programs&gt;</span><br />    <span style="color: #007000;">&lt;/configuration&gt;</span><br />    <span style="color: #007000;">&lt;executions&gt;</span><br />        <span style="color: #007000;">&lt;execution&gt;</span><br />            <span style="color: #007000;">&lt;phase&gt;</span>package<span style="color: #007000;">&lt;/phase&gt;</span><br />            <span style="color: #007000;">&lt;goals&gt;</span><br />                <span style="color: #007000;">&lt;goal&gt;</span>assemble<span style="color: #007000;">&lt;/goal&gt;</span><br />            <span style="color: #007000;">&lt;/goals&gt;</span><br />        <span style="color: #007000;">&lt;/execution&gt;</span><br />    <span style="color: #007000;">&lt;/executions&gt;</span><br /><span style="color: #007000;">&lt;/plugin&gt;</span><br /></pre></td></tr></tbody></table></div><br />Done. Appassembler now creates executable scripts for all platforms inside the <i>target/myapp/bin</i> directory. You could even put configuration files into <i>src/main/config</i> that would be copied into <i>target/myapp/conf</i> automatically by the plugin.<br /><br /><h2>Result</h2><br />If we run mvn clean package now we get a completely transportable standalone webapp in our <i>target</i> directory!<br /><br /><h2></h2><h2></h2>