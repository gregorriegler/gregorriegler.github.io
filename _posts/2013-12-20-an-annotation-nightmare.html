---
layout: post
title: An Annotation Nightmare
date: '2013-12-20T20:15:00.000+01:00'
author: Gregor
tags:
- Java
- Hibernate
- Clean Code
- Spring
modified_time: '2013-12-22T17:07:37.308+01:00'
blogger_id: tag:blogger.com,1999:blog-1178805312154210159.post-2362108771381301950
blogger_orig_url: http://www.beabetterdeveloper.com/2013/12/an-annotation-nightmare.html
---

<div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #555555; font-weight: bold;">@XmlElementWrapper</span><span style="color: #333333;">(</span>name<span style="color: #333333;">=</span><span style="background-color: #fff0f0;">"orders"</span><span style="color: #333333;">)</span><br /><span style="color: #555555; font-weight: bold;">@XmlJavaTypeAdapter</span><span style="color: #333333;">(</span>OrderJaxbAdapter<span style="color: #333333;">.</span><span style="color: #0000cc;">class</span><span style="color: #333333;">)</span><br /><span style="color: #555555; font-weight: bold;">@XmlElements</span><span style="color: #333333;">({</span><br />   <span style="color: #555555; font-weight: bold;">@XmlElement</span><span style="color: #333333;">(</span>name<span style="color: #333333;">=</span><span style="background-color: #fff0f0;">"order_2"</span><span style="color: #333333;">,</span>type<span style="color: #333333;">=</span>Order2<span style="color: #333333;">.</span><span style="color: #0000cc;">class</span><span style="color: #333333;">),</span><br />   <span style="color: #555555; font-weight: bold;">@XmlElement</span><span style="color: #333333;">(</span>name<span style="color: #333333;">=</span><span style="background-color: #fff0f0;">"old_order"</span><span style="color: #333333;">,</span>type<span style="color: #333333;">=</span>OldOrder<span style="color: #333333;">.</span><span style="color: #0000cc;">class</span><span style="color: #333333;">)</span><br /><span style="color: #333333;">})</span><br /><span style="color: #555555; font-weight: bold;">@JsonIgnore</span><br /><span style="color: #555555; font-weight: bold;">@JsonProperty</span><br /><span style="color: #555555; font-weight: bold;">@NotNull</span><br /><span style="color: #555555; font-weight: bold;">@ManyToMany</span><br /><span style="color: #555555; font-weight: bold;">@Fetch</span><span style="color: #333333;">(</span>FetchMode<span style="color: #333333;">.</span><span style="color: #0000cc;">SUBSELECT</span><span style="color: #333333;">)</span><br /><span style="color: #555555; font-weight: bold;">@JoinTable</span><span style="color: #333333;">(</span><br />    name <span style="color: #333333;">=</span> <span style="background-color: #fff0f0;">"customer_order"</span><span style="color: #333333;">,</span><br />    joinColumns <span style="color: #333333;">=</span> <span style="color: #333333;">{</span><br />        <span style="color: #555555; font-weight: bold;">@JoinColumn</span><span style="color: #333333;">(</span>name <span style="color: #333333;">=</span> <span style="background-color: #fff0f0;">"customer_id"</span><span style="color: #333333;">,</span> referencedColumnName <span style="color: #333333;">=</span> <span style="background-color: #fff0f0;">"id"</span><span style="color: #333333;">)</span><br />    <span style="color: #333333;">},</span><br />    inverseJoinColumns <span style="color: #333333;">=</span> <span style="color: #333333;">{</span><br />        <span style="color: #555555; font-weight: bold;">@JoinColumn</span><span style="color: #333333;">(</span>name <span style="color: #333333;">=</span> <span style="background-color: #fff0f0;">"order_id"</span><span style="color: #333333;">,</span> referencedColumnName <span style="color: #333333;">=</span> <span style="background-color: #fff0f0;">"id"</span><span style="color: #333333;">)</span><br />    <span style="color: #333333;">}</span><br /><span style="color: #333333;">)</span><br /><span style="color: #008800; font-weight: bold;">private</span> List orders<span style="color: #333333;">;</span><br /></pre></div><br />Wait. What? Is this really what we have come to? I can't even see the damn property under this bloat. How did this happen? Yeah ok - we had to get rid of the old xml configuration horror somehow. But this? This is even WORSE. This class is supposed to be a goddamn pojo with a bunch of properties. Short and concise, easy to read. I, as a reader of this cass, am not interested at all how the database table is joining customers to orders. I'm neither interested how its being serialized. This is just implementation details. Reading this class, i am living in an object world and i want to know what data and behaviour the object has. Not more, not less. I don't care about column names, fetchtypes or json serialization for the moment. And i don't want to read, change or recompile this class for the sake of a tablename change. I don't want to add another annotation for storing this entity in a mongoDB neither. The entity should not have responsibility for these details. We are not only violating the Single Responsibility Principle here, we are doing a f****** responsibility party.<br /><br />Ok ok, enough of the rage. How do we deal with this issue? Some duplicate the entity for various layers with different annotation purposes. They map the entity onto the next layers related entity using an automated mapper like Dozer. Some even write that mapping themselves. But this is by no means a solution. It is just replacing one code smell with another one: Duplication.<br /><br />So please, focus on frameworks that don't force you to clutter your code.&nbsp;<a href="http://www.jooq.org/">jOOQ</a> is a nice solution to map database records to entities without annotations. Also, hibernate allows you to define your mappings in XML.<br /><br /><h3>Private Field Injection</h3><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #555555; font-weight: bold;">@Inject</span><br /><span style="color: #008800; font-weight: bold;">private</span> MyService myService<br /></pre></div><br />This is used quite often, while it shouldn't even be possible. The myService field is private, thus it's inaccessible from outside the class. Nevertheless it's possible and people do it. In reality it is a hack. The DI-framework sets the field using reflections doing setAccessible(true). You don't want hacks in your code, do you? Lets have a look at the alternatives:<br /><br /><b>Setter Injection</b><br />Well, at least its better than the private field injection, since its using a public method instead of hacking a private field. But still, ask yourself this: 'Is this class even supposed to live without the injected value?' Because if it's not, there is no reason what so ever for the class to get constructed without an instance of MyService. You want to implement this constraint on the class level and inside the constructor, not on the framework level.<br /><br /><b>Constructor Injection</b><br />This is usually the way to go. It allows you to<br /><ul><li>make the field immutable (there is usually no need to change it).</li><li>implement the constraint, that the class is not instantiatable without a given <i>MyService</i> in the right place.</li></ul>Of course it means that you cannot inject by annotation. But why would you want to? The class doesn't need to know, if it gets injections by a DI-Container or a Factory Class. It should not know anything of this. No @Autowired, no @Qualifier. All it needs to know is its own behaviour. Everything else should be handled outside of the class.<br />One could use a configuration class or file for the actual injection.<br /><br />A DI-Container is a usefull tool that helps you wire your classes together. Use it for this purpose, but don't let it dictate your code. Uncle Bob wrote a great <a href="http://bit.ly/1hrE1Kf">post</a> where he explained how to use DI-Frameworks without having them dictate your code. <br /><br /><h3><complete id="goog_238306818">@RunWith(SpringJUnit4ClassRunner.class) in UnitTests</complete></h3><complete id="goog_238306818"></complete>Why would you need this in unittests? Because it is automatically generated by your IDE/app template? No! You want to test the behaviour of a class, living in isolation in unittests. Not if the DI-Conainer is injecting a fields accordingly. Just inject yourself in a setup method. No DI-Container needed. By the way, all this testrunner does is these 3 lines of code.<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #008800; font-weight: bold;">private</span> TestContextManager testContextManager<span style="color: #333333;">;</span><br /><span style="color: #888888;">//..</span><br /><span style="color: #008800; font-weight: bold;">this</span><span style="color: #333333;">.</span><span style="color: #0000cc;">testContextManager</span> <span style="color: #333333;">=</span> <span style="color: #008800; font-weight: bold;">new</span> TestContextManager<span style="color: #333333;">(</span>getClass<span style="color: #333333;">());</span><br /><span style="color: #008800; font-weight: bold;">this</span><span style="color: #333333;">.</span><span style="color: #0000cc;">testContextManager</span><span style="color: #333333;">.</span><span style="color: #0000cc;">prepareTestInstance</span><span style="color: #333333;">(</span><span style="color: #008800; font-weight: bold;">this</span><span style="color: #333333;">);</span><br /></pre></div><br />They are not worth blocking your only TestRunner slot. You want to keep it free for something like parameterized <i>@RunWith(<span class="ifClosed" id="crumb_links">JUnitParamsRunner.class)</span></i> or concurrency <i>@RunWith(ConcurrentJunitRunner.class)</i> tests.<br /><br /><h3>@Override</h3>Really, my IDE already knows if i am correctly overriding a method. To me, its just clutter.<br /><br /><h3>@SuppressWarnings </h3>... Don't even get me started<br /><br /><i><b>tl;dr</b></i><br /><i>Annotations have become more harmful than helpful these days. We should get back to pojos and focus on keeping our code as clutterless and framework-agnostic as possible to make it more readable and reuseable. Don't let frameworks dictate your codebases, since they should be exchangable tools. Beware of what a class should know, and what not. Some annotations are useful, most aren't.</i><br /><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #555555; font-weight: bold;">@DevNull</span><span style="color: #333333;">({</span></pre><pre style="line-height: 125%; margin: 0;"><span style="color: #333333;"></span> <span style="color: #555555; font-weight: bold;">@SuppressWarnings</span></pre><pre style="line-height: 125%; margin: 0;"><span style="color: #333333;"></span> <span style="color: #555555; font-weight: bold;"><span style="color: #555555; font-weight: bold;">@Autowired</span><span style="color: #333333;">,</span> </span><br /> <span style="color: #555555; font-weight: bold;"><span style="color: #555555; font-weight: bold;">@Inject</span><span style="color: #333333;">,</span>&nbsp;</span></pre><pre style="line-height: 125%; margin: 0;"><span style="color: #555555; font-weight: bold;"></span> <span style="color: #555555; font-weight: bold;"><span style="color: #555555; font-weight: bold;"><span style="color: #555555; font-weight: bold;">@Override</span><span style="color: #333333;">,&nbsp;</span></span> </span></pre><pre style="line-height: 125%; margin: 0;"> <span style="color: #555555; font-weight: bold;">@XmlElementWrapper</span><span style="color: #333333;">,</span><br /> <span style="color: #555555; font-weight: bold;">@XmlJavaTypeAdapter</span><span style="color: #333333;">,</span><br /> <span style="color: #555555; font-weight: bold;">@XmlElement</span><span style="color: #333333;">,</span><br /> <span style="color: #555555; font-weight: bold;">@JsonIgnore</span><span style="color: #333333;">,</span><br /> <span style="color: #555555; font-weight: bold;">@JsonProperty</span><span style="color: #333333;">,</span><br /> <span style="color: #555555; font-weight: bold;">@ManyToMany</span><span style="color: #333333;">,</span><br /> <span style="color: #555555; font-weight: bold;">@Fetch</span><span style="color: #333333;">,</span><br /> <span style="color: #555555; font-weight: bold;">@JoinTable</span><br /><span style="color: #333333;">})</span><br /></pre></div>