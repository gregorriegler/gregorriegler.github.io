---
layout: post
title: Spring MVC - @RequestBody and @ResponseBody demystified
date: '2013-07-21T01:16:00.001+02:00'
author: Gregor
tags:
- Java
- REST
- Spring MVC
- Spring
modified_time: '2013-08-05T19:23:18.010+02:00'
blogger_id: tag:blogger.com,1999:blog-1178805312154210159.post-7432727248767280713
blogger_orig_url: http://www.beabetterdeveloper.com/2013/07/spring-mvc-requestbody-and-responsebody.html
---

In this post i want to dig into spring mvc a little, revealing what happens behind the scenes when a request is converted to your parameter object and vice versa. Before we start, i want to explain the purpose of these annotations.<br /><br /><h3>What are @RequestBody and @ResponseBody for? </h3><br />They are annotations of the spring mvc framework and can be used in a controller to implement smart object serialization and deserialization. They help you avoid boilerplate code by extracting the logic of messageconversion and making it an aspect. Other than that they help you support multiple formats for a single REST resource without duplication of code. If you annotate a method with @ResponseBody, spring will try to convert its return value and write it to the http response automatically. If you annotate a methods parameter with @RequestBody, spring will try to convert the content of the incoming request body to your parameter object on the fly.<br /><br />Here is an example<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #555555; font-weight: bold;">@Controller</span><br /><span style="color: #555555; font-weight: bold;">@RequestMapping</span><span style="color: #333333;">(</span>value <span style="color: #333333;">=</span> <span style="background-color: #fff0f0;">"/bookcase"</span><span style="color: #333333;">)</span><br /><span style="color: #008800; font-weight: bold;">public</span> <span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">BookCaseController</span> <span style="color: #333333;">{</span><br /><br />    <span style="color: #008800; font-weight: bold;">private</span> BookCase bookCase<span style="color: #333333;">;</span><br /><br />    <span style="color: #555555; font-weight: bold;">@RequestMapping</span><span style="color: #333333;">(</span>method <span style="color: #333333;">=</span> RequestMethod<span style="color: #333333;">.</span><span style="color: #0000cc;">GET</span><span style="color: #333333;">)</span><br />    <span style="color: #555555; font-weight: bold;">@ResponseBody</span><br />    <span style="color: #008800; font-weight: bold;">public</span> BookCase <span style="color: #0066bb; font-weight: bold;">getBookCase</span><span style="color: #333333;">()</span> <span style="color: #333333;">{</span><br />        <span style="color: #008800; font-weight: bold;">return</span> <span style="color: #008800; font-weight: bold;">this</span><span style="color: #333333;">.</span><span style="color: #0000cc;">bookCase</span><span style="color: #333333;">;</span><br />    <span style="color: #333333;">}</span><br /><br />    <span style="color: #555555; font-weight: bold;">@RequestMapping</span><span style="color: #333333;">(</span>method <span style="color: #333333;">=</span> RequestMethod<span style="color: #333333;">.</span><span style="color: #0000cc;">PUT</span><span style="color: #333333;">)</span><br />    <span style="color: #555555; font-weight: bold;">@ResponseStatus</span><span style="color: #333333;">(</span>HttpStatus<span style="color: #333333;">.</span><span style="color: #0000cc;">NO_CONTENT</span><span style="color: #333333;">)</span><br />    <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #333399; font-weight: bold;">void</span> <span style="color: #0066bb; font-weight: bold;">setBookCase</span><span style="color: #333333;">(</span><span style="color: #555555; font-weight: bold;">@RequestBody</span> BookCase bookCase<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />        <span style="color: #008800; font-weight: bold;">this</span><span style="color: #333333;">.</span><span style="color: #0000cc;">bookCase</span> <span style="color: #333333;">=</span> bookCase<span style="color: #333333;">;</span><br />    <span style="color: #333333;">}</span><br /><br /><span style="color: #333333;">}</span><br /></pre></div><br /><h3>So what is Spring doing behind the scenes when we are using those Annotations?</h3><br />Depending on your configuration, spring has a list of <a href="http://static.springsource.org/spring/docs/3.2.x/javadoc-api/org/springframework/http/converter/HttpMessageConverter.html">HttpMessageConverters</a> registered in the background. A HttpMessageConverters responsibility is to convert the request body to a specific class and back to the response body again, depending on a predefined <a href="http://de.wikipedia.org/wiki/Multipurpose_Internet_Mail_Extensions">mime type</a>. Every time an issued request is hitting a @RequestBody or @ResponseBody annotation spring loops through all registered HttpMessageConverters seeking for the first that fits the given mime type and class and then uses it for the actual conversion.<br /><br /><h3>How can i add a custom HttpMessageConverter?</h3><br />By adding @EnableWebMvc respectively &lt;mvc:annotation-driven /&gt;, spring registers a bunch of predefined messageconverters for JSON/XML and so on. You can add a custom converter like the following<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #555555; font-weight: bold;">@Configuration</span><br /><span style="color: #555555; font-weight: bold;">@EnableWebMvc</span><br /><span style="color: #555555; font-weight: bold;">@ComponentScan</span><br /><span style="color: #008800; font-weight: bold;">public</span> <span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">WebConfiguration</span> <span style="color: #008800; font-weight: bold;">extends</span> WebMvcConfigurerAdapter <span style="color: #333333;">{</span><br /><br />    <span style="color: #555555; font-weight: bold;">@Override</span><br />    <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #333399; font-weight: bold;">void</span> <span style="color: #0066bb; font-weight: bold;">configureMessageConverters</span><span style="color: #333333;">(</span>List<span style="color: #333333;">&lt;</span>HttpMessageConverter<span style="color: #333333;">&lt;?&gt;&gt;</span> httpMessageConverters<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />        httpMessageConverters<span style="color: #333333;">.</span><span style="color: #0000cc;">add</span><span style="color: #333333;">(</span><span style="color: #008800; font-weight: bold;">new</span> BookCaseMessageConverter<span style="color: #333333;">(</span><span style="color: #008800; font-weight: bold;">new</span> MediaType<span style="color: #333333;">(</span><span style="background-color: #fff0f0;">"text"</span><span style="color: #333333;">,</span> <span style="background-color: #fff0f0;">"csv"</span><span style="color: #333333;">)));</span><br />    <span style="color: #333333;">}</span><br /><span style="color: #333333;">}</span><br /></pre></div><br />In this example i've written a converter that handles the conversion of a BookCase, which is basically a List of Books. The converter is able to convert csv content to a BookCase and vice versa. I used <a href="http://opencsv.sourceforge.net/">opencsv </a>to parse the text.<br /><br />Here is the model<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #008800; font-weight: bold;">public</span> <span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">Book</span> <span style="color: #333333;">{</span><br /><br />    <span style="color: #008800; font-weight: bold;">private</span> String isbn<span style="color: #333333;">;</span><br /><br />    <span style="color: #008800; font-weight: bold;">private</span> String title<span style="color: #333333;">;</span><br /><br />    <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #0066bb; font-weight: bold;">Book</span><span style="color: #333333;">(</span>String isbn<span style="color: #333333;">,</span> String title<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />        <span style="color: #008800; font-weight: bold;">this</span><span style="color: #333333;">.</span><span style="color: #0000cc;">isbn</span> <span style="color: #333333;">=</span> isbn<span style="color: #333333;">;</span><br />        <span style="color: #008800; font-weight: bold;">this</span><span style="color: #333333;">.</span><span style="color: #0000cc;">title</span> <span style="color: #333333;">=</span> title<span style="color: #333333;">;</span><br />    <span style="color: #333333;">}</span><br /><br />    <span style="color: #888888;">// ...</span><br /><span style="color: #333333;">}</span><br /><br /><span style="color: #008800; font-weight: bold;">public</span> <span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">BookCase</span> <span style="color: #008800; font-weight: bold;">extends</span> ArrayList<span style="color: #333333;">&lt;</span>Book<span style="color: #333333;">&gt;</span> <span style="color: #333333;">{</span><br /><br />    <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #0066bb; font-weight: bold;">BookCase</span><span style="color: #333333;">()</span> <span style="color: #333333;">{</span><br />    <span style="color: #333333;">}</span><br /><br />    <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #0066bb; font-weight: bold;">BookCase</span><span style="color: #333333;">(</span>Collection<span style="color: #333333;">&lt;?</span> <span style="color: #008800; font-weight: bold;">extends</span> Book<span style="color: #333333;">&gt;</span> c<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />        <span style="color: #008800; font-weight: bold;">super</span><span style="color: #333333;">(</span>c<span style="color: #333333;">);</span><br />    <span style="color: #333333;">}</span><br /><span style="color: #333333;">}</span><br /></pre></div><br />and the actual converter<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #008800; font-weight: bold;">public</span> <span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">BookCaseMessageConverter</span> <span style="color: #008800; font-weight: bold;">extends</span> AbstractHttpMessageConverter<span style="color: #333333;">&lt;</span>BookCase<span style="color: #333333;">&gt;</span> <span style="color: #333333;">{</span><br /><br />    <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #0066bb; font-weight: bold;">BookCaseMessageConverter</span><span style="color: #333333;">()</span> <span style="color: #333333;">{</span><br />    <span style="color: #333333;">}</span><br /><br />    <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #0066bb; font-weight: bold;">BookCaseMessageConverter</span><span style="color: #333333;">(</span>MediaType supportedMediaType<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />        <span style="color: #008800; font-weight: bold;">super</span><span style="color: #333333;">(</span>supportedMediaType<span style="color: #333333;">);</span><br />    <span style="color: #333333;">}</span><br /><br />    <span style="color: #008800; font-weight: bold;">public</span> <span style="color: #0066bb; font-weight: bold;">BookCaseMessageConverter</span><span style="color: #333333;">(</span>MediaType<span style="color: #333333;">...</span> supportedMediaTypes<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />        <span style="color: #008800; font-weight: bold;">super</span><span style="color: #333333;">(</span>supportedMediaTypes<span style="color: #333333;">);</span><br />    <span style="color: #333333;">}</span><br /><br />    <span style="color: #555555; font-weight: bold;">@Override</span><br />    <span style="color: #008800; font-weight: bold;">protected</span> <span style="color: #333399; font-weight: bold;">boolean</span> <span style="color: #0066bb; font-weight: bold;">supports</span><span style="color: #333333;">(</span>Class<span style="color: #333333;">&lt;?&gt;</span> clazz<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />        <span style="color: #008800; font-weight: bold;">return</span> BookCase<span style="color: #333333;">.</span><span style="color: #0000cc;">class</span><span style="color: #333333;">.</span><span style="color: #0000cc;">equals</span><span style="color: #333333;">(</span>clazz<span style="color: #333333;">);</span><br />    <span style="color: #333333;">}</span><br /><br />    <span style="color: #555555; font-weight: bold;">@Override</span><br />    <span style="color: #008800; font-weight: bold;">protected</span> BookCase <span style="color: #0066bb; font-weight: bold;">readInternal</span><span style="color: #333333;">(</span>Class<span style="color: #333333;">&lt;?</span> <span style="color: #008800; font-weight: bold;">extends</span> BookCase<span style="color: #333333;">&gt;</span> clazz<span style="color: #333333;">,</span> HttpInputMessage httpInputMessage<span style="color: #333333;">)</span> <span style="color: #008800; font-weight: bold;">throws</span> IOException<span style="color: #333333;">,</span> HttpMessageNotReadableException <span style="color: #333333;">{</span><br />        CSVReader reader <span style="color: #333333;">=</span> <span style="color: #008800; font-weight: bold;">new</span> CSVReader<span style="color: #333333;">(</span><span style="color: #008800; font-weight: bold;">new</span> InputStreamReader<span style="color: #333333;">(</span>httpInputMessage<span style="color: #333333;">.</span><span style="color: #0000cc;">getBody</span><span style="color: #333333;">()));</span><br />        List<span style="color: #333333;">&lt;</span>String<span style="color: #333333;">[]&gt;</span> rows <span style="color: #333333;">=</span> reader<span style="color: #333333;">.</span><span style="color: #0000cc;">readAll</span><span style="color: #333333;">();</span><br />        BookCase bookCase <span style="color: #333333;">=</span> <span style="color: #008800; font-weight: bold;">new</span> BookCase<span style="color: #333333;">();</span><br />        <span style="color: #008800; font-weight: bold;">for</span> <span style="color: #333333;">(</span>String<span style="color: #333333;">[]</span> row <span style="color: #333333;">:</span> rows<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />            bookCase<span style="color: #333333;">.</span><span style="color: #0000cc;">add</span><span style="color: #333333;">(</span><span style="color: #008800; font-weight: bold;">new</span> Book<span style="color: #333333;">(</span>row<span style="color: #333333;">[</span><span style="color: #0000dd; font-weight: bold;">0</span><span style="color: #333333;">],</span> row<span style="color: #333333;">[</span><span style="color: #0000dd; font-weight: bold;">1</span><span style="color: #333333;">]));</span><br />        <span style="color: #333333;">}</span><br />        <span style="color: #008800; font-weight: bold;">return</span> bookCase<span style="color: #333333;">;</span><br />    <span style="color: #333333;">}</span><br /><br />    <span style="color: #555555; font-weight: bold;">@Override</span><br />    <span style="color: #008800; font-weight: bold;">protected</span> <span style="color: #333399; font-weight: bold;">void</span> <span style="color: #0066bb; font-weight: bold;">writeInternal</span><span style="color: #333333;">(</span>BookCase books<span style="color: #333333;">,</span> HttpOutputMessage httpOutputMessage<span style="color: #333333;">)</span> <span style="color: #008800; font-weight: bold;">throws</span> IOException<span style="color: #333333;">,</span> HttpMessageNotWritableException <span style="color: #333333;">{</span><br />        CSVWriter writer <span style="color: #333333;">=</span> <span style="color: #008800; font-weight: bold;">new</span> CSVWriter<span style="color: #333333;">(</span><span style="color: #008800; font-weight: bold;">new</span> OutputStreamWriter<span style="color: #333333;">(</span>httpOutputMessage<span style="color: #333333;">.</span><span style="color: #0000cc;">getBody</span><span style="color: #333333;">()));</span><br />        <span style="color: #008800; font-weight: bold;">for</span> <span style="color: #333333;">(</span>Book book <span style="color: #333333;">:</span> books<span style="color: #333333;">)</span> <span style="color: #333333;">{</span><br />            writer<span style="color: #333333;">.</span><span style="color: #0000cc;">writeNext</span><span style="color: #333333;">(</span><span style="color: #008800; font-weight: bold;">new</span> String<span style="color: #333333;">[]{</span>book<span style="color: #333333;">.</span><span style="color: #0000cc;">getIsbn</span><span style="color: #333333;">(),</span> book<span style="color: #333333;">.</span><span style="color: #0000cc;">getTitle</span><span style="color: #333333;">()});</span><br />        <span style="color: #333333;">}</span><br />        writer<span style="color: #333333;">.</span><span style="color: #0000cc;">close</span><span style="color: #333333;">();</span><br />    <span style="color: #333333;">}</span><br /><span style="color: #333333;">}</span><br /></pre></div><br /><h3>The Result&nbsp; </h3>We can now issue text/csv requests to our Resource along with application/json and xml which are basically supported out of the box.<br /><br />1.)<br /><pre><b>PUT /bookcase</b><br /><i><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv">Content-Type: text/csv</span></i><br /><span style="color: blue;"><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv">"123","Spring in Action"<br />"456","Clean Code"</span></span><br /><br /><b><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv">Response</span></b><br /><span style="color: #6aa84f;"><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv">204 No Content</span></span></pre>2.)<span style="color: #6aa84f;"><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv"></span></span><br /><pre><b><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv">GET /bookcase</span></b><br /><i><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv">Accept: text/csv</span></i><br /><br /><b><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv">Response</span></b><br /><span style="color: #6aa84f;"><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv">200 OK</span></span><br /><span style="color: blue;"><span class="label" data-header-id="f9beee7543227809ba788522f2ba5b9d61a0d03a" title="Content-Type: text/csv">"123","Spring in Action"<br />"456","Clean Code"</span></span><br /></pre><br />Thanks to the design of spring mvc, which is following the single responsibility principle, our controller stays thin. We don't have to add a single line if we want to support new media types.<br /><br /><h3>The complete example is available on my <a href="https://github.com/gregorriegler/babdev-spring/tree/master/message-converter">github</a>  </h3>