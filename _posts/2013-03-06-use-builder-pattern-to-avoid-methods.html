---
layout: post
title: Avoid too many Parameters using the Builder Pattern
date: '2013-03-06T20:20:00.000+01:00'
author: Gregor
tags:
- Criteria Query
- Java
- Fluent Interface
- DAO
- Spring-Data
- Clean Code
- Builder Pattern
- Query Object
- Spring
- Design Patterns
modified_time: '2013-08-03T21:01:49.617+02:00'
blogger_id: tag:blogger.com,1999:blog-1178805312154210159.post-234351805660925406
blogger_orig_url: http://www.beabetterdeveloper.com/2013/03/use-builder-pattern-to-avoid-methods.html
---

Today i want to show you another way to use the <a href="http://en.wikipedia.org/wiki/Builder_pattern">Builder Pattern</a>. From what i<cite><b>'</b></cite>ve seen there are tons of examples of the Builder Pattern online. But they do all have one thing in common: They are used to create an Instance of an Object and "replace" its constructor. This way you can create a complex Object in a very clean and readable fashion using a <a href="http://en.wikipedia.org/wiki/Fluent_interface">Fluent Interface</a>.<br /><br />Other than that, there is also a slightly different way you can benefit of the Builder Pattern. Think of a Method with like 10 Parameters. Thats not quite nice, and should not ever happen. Robert C. Martin recommends a maximum amount of 3 Parameters in his book: <a href="http://www.amazon.com/dp/0132350882/?tag=stackoverfl08-20">Clean Code</a>. You should rather use some kind of a Config Object holding those 10 parameters, to clean it up. But lets say, you have a BookService Class with a find(..) method, that allows to search by 10 different parameters, and every single one of them is optional. You could use the Builder Pattern with some kind of <a href="http://www.martinfowler.com/eaaCatalog/queryObject.html">Query Object</a> to solve the problem.<br /><br />As we should always program against Interfaces to keep things modular, ill start with the Interface:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">interface</span> <span style="color: #b00060; font-weight: bold;">BookService</span> <span style="color: #303030;">{</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> Book <span style="color: #0060b0; font-weight: bold;">create</span><span style="color: #303030;">(</span>Book book<span style="color: #303030;">);</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> <span style="color: #303090; font-weight: bold;">void</span> <span style="color: #0060b0; font-weight: bold;">delete</span><span style="color: #303030;">(</span>String isbn<span style="color: #303030;">);</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">query</span><span style="color: #303030;">();</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">interface</span> <span style="color: #b00060; font-weight: bold;">Query</span> <span style="color: #303030;">{</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">isName</span><span style="color: #303030;">(</span>String name<span style="color: #303030;">);</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">hasAuthor</span><span style="color: #303030;">(</span>String author<span style="color: #303030;">);</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">isCheaperThan</span><span style="color: #303030;">(</span>Float price<span style="color: #303030;">);</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">isIsbn</span><span style="color: #303030;">(</span>String isbn<span style="color: #303030;">);</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">hasMorePagesThan</span><span style="color: #303030;">(</span>Long pages<span style="color: #303030;">);</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">isAvailable</span><span style="color: #303030;">();</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> find<span style="color: #303030;">();</span><br /><br />    <span style="color: #303030;">}</span><br /><span style="color: #303030;">}</span><br /></pre></td></tr></tbody></table></div><br />So the Interface looks pretty neat. It allows you to write something like: <br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><pre style="line-height: 125%; margin: 0;">bookService<span style="color: #303030;">.</span><span style="color: #0000c0;">query</span><span style="color: #303030;">().</span><span style="color: #0000c0;">hasAuthor</span><span style="color: #303030;">(</span><span style="background-color: #fff0f0;">"Bob"</span><span style="color: #303030;">).</span><span style="color: #0000c0;">isCheaperThan</span><span style="color: #303030;">(</span><span style="color: #6000e0; font-weight: bold;">20.9</span><span style="color: #303030;">).</span><span style="color: #0000c0;">isAvailable</span><span style="color: #303030;">().</span><span style="color: #0000c0;">find</span><span style="color: #303030;">();</span><br /></pre></div><br />While the Query could be considered as an implementation of the <a href="http://www.martinfowler.com/eaaCatalog/queryObject.html">Query Object pattern</a> it is not tied to any Database related stuff, which is very important. You dont want to be tied to Criteria Queries or SQL in this Layer. It should be independent of any implementation (e.g. Database or Filesystem).<br /><br />To clear things up, i want to show you an implementation example using <a href="http://www.springsource.org/spring-data">Spring-Data</a>. I am a big fan of Spring-Data, since it allows you to create full featured DAOs with little to no Programming effort for many different Persistence Providers. If you havent used it yet, you should definitely give it a try. <br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23<br />24<br />25<br />26<br />27<br />28<br />29<br />30<br />31<br />32<br />33<br />34<br />35<br />36<br />37<br />38<br />39<br />40<br />41<br />42<br />43<br />44</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">class</span> <span style="color: #b00060; font-weight: bold;">BookServiceImpl</span> <span style="color: green; font-weight: bold;">implements</span> BookService <span style="color: #303030;">{</span><br /><br />    <span style="color: #505050; font-weight: bold;">@Autowired</span><br />    <span style="color: green; font-weight: bold;">private</span> BookRepository bookRepository<span style="color: #303030;">;</span><br /><br />    <span style="color: grey;">// ...</span><br /><br />    <span style="color: #505050; font-weight: bold;">@Override</span><br />    
<span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">query</span><span style="color: #303030;">()</span> <span style="color: #303030;">{</span><br />        <span style="color: green; font-weight: bold;">return</span> <span style="color: green; font-weight: bold;">new</span> <span style="color: #0060b0; font-weight: bold;">QueryImpl</span><span style="color: #303030;">(</span><span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">.</span><span style="color: #0000c0;">bookRepository</span><span style="color: #303030;">);</span><br />    <span style="color: #303030;">}</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">class</span> <span style="color: #b00060; font-weight: bold;">QueryImpl</span> <span style="color: green; font-weight: bold;">implements</span> Query<span style="color: #303030;">{</span><br /><br />        <span style="color: green; font-weight: bold;">private</span> BookRepository bookRepository<span style="color: #303030;">;</span><br />        <span style="color: green; font-weight: bold;">private</span> Specifications<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> filters <span style="color: #303030;">=</span> <span style="color: green; font-weight: bold;">null</span><span style="color: #303030;">;</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> <span style="color: #0060b0; font-weight: bold;">QueryImpl</span><span style="color: #303030;">(</span>BookRepository bookRepository<span style="color: #303030;">)</span> <span style="color: #303030;">{</span><br />            <span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">.</span><span style="color: #0000c0;">bookRepository</span> <span style="color: #303030;">=</span> bookRepository<span style="color: #303030;">;</span><br />        <span style="color: #303030;">}</span><br /><br />        <span style="color: green; font-weight: bold;">private</span> <span style="color: #303090; font-weight: bold;">void</span> <span style="color: #0060b0; font-weight: bold;">addFilter</span><span style="color: #303030;">(</span>Specification<span style="color: #303030;">&lt;</span>FlowMessage<span style="color: #303030;">&gt;</span> filter<span style="color: #303030;">)</span> <span style="color: #303030;">{</span><br />            filters <span style="color: #303030;">=</span> <span style="color: #303030;">(</span>filters <span style="color: #303030;">==</span> <span style="color: green; font-weight: bold;">null</span><span style="color: #303030;">)</span> <span style="color: #303030;">?</span> where<span style="color: #303030;">(</span>filter<span style="color: #303030;">)</span> <span style="color: #303030;">:</span> filters<span style="color: #303030;">.</span><span style="color: #0000c0;">and</span><span style="color: #303030;">(</span>filter<span style="color: #303030;">);</span><br />        <span style="color: #303030;">}</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">isName</span><span style="color: #303030;">(</span>String name<span style="color: #303030;">)</span> <span style="color: #303030;">{</span><br />            <span style="color: green; font-weight: bold;">if</span> <span style="color: #303030;">(</span>name <span style="color: #303030;">==</span> <span style="color: green; font-weight: bold;">null</span><span style="color: #303030;">)</span> <span style="color: green; font-weight: bold;">return</span> <span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">;</span><br />            addFilter<span style="color: #303030;">(</span>BookSpecifications<span style="color: #303030;">.</span><span style="color: #0000c0;">isName</span><span style="color: #303030;">(</span>name<span style="color: #303030;">));</span><br />            <span style="color: green; font-weight: bold;">return</span> <span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">;</span><br />        <span style="color: #303030;">}</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> Query <span style="color: #0060b0; font-weight: bold;">hasAuthor</span><span style="color: #303030;">(</span>String author<span style="color: #303030;">)</span> <span style="color: #303030;">{</span><br />            <span style="color: green; font-weight: bold;">if</span> <span style="color: #303030;">(</span>author <span style="color: #303030;">==</span> <span style="color: green; font-weight: bold;">null</span><span style="color: #303030;">)</span> <span style="color: green; font-weight: bold;">return</span> <span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">;</span><br />            addFilter<span style="color: #303030;">(</span>BookSpecifications<span style="color: #303030;">.</span><span style="color: #0000c0;">hasAuthor</span><span style="color: #303030;">(</span>author<span style="color: #303030;">));</span><br />            <span style="color: green; font-weight: bold;">return</span> <span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">;</span><br />        <span style="color: #303030;">}</span><br /><br />        <span style="color: grey;">// other criterias ...</span><br /><br />        <span style="color: green; font-weight: bold;">public</span> List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> find<span style="color: #303030;">()</span> <span style="color: #303030;">{</span><br />            <span style="color: green; font-weight: bold;">return</span> <span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">.</span><span style="color: #0000c0;">bookRepository</span><span style="color: #303030;">.</span><span style="color: #0000c0;">findAll</span><span style="color: #303030;">(</span>filters<span style="color: #303030;">);</span><br />        <span style="color: #303030;">}</span><br />    <span style="color: #303030;">}</span><br /><span style="color: #303030;">}</span><br /></pre></td></tr></tbody></table></div><br />As you can see i am just joining filter <a href="http://www.objectdb.com/java/jpa/query/criteria">Criterias</a> together, and thats it. The implementation is really simple but also expandable. These filter Criterias are supported by my BookRepository (=<a href="http://de.wikipedia.org/wiki/Data_Access_Object">DAO</a>). I just have to define them in a helper class first. Check out <a href="http://blog.springsource.org/2011/04/26/advanced-spring-data-jpa-specifications-and-querydsl/">this</a> and <a href="http://www.petrikainulainen.net/programming/spring-framework/spring-data-jpa-tutorial-part-four-jpa-criteria-queries/">that</a> for a deeper understanding how to combine spring-data with criteria queries.<br /><br /><br /><br /><br />
