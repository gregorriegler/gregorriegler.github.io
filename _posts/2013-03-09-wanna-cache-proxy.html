---
layout: post
title: Wanna Cache? Proxy!
date: '2013-03-09T17:20:00.001+01:00'
author: Gregor
tags:
- Java
- Modularity
- Cache
- Proxy Pattern
- Design Patterns
modified_time: '2013-08-03T21:02:06.554+02:00'
thumbnail: http://3.bp.blogspot.com/-5tWIyDICVvM/UTtSn3qThiI/AAAAAAAAAAg/AYI4tvgmpyA/s72-c/decorator_pattern.png
blogger_id: tag:blogger.com,1999:blog-1178805312154210159.post-183359315240788454
blogger_orig_url: http://www.beabetterdeveloper.com/2013/03/wanna-cache-decorate.html
---

<div style="background-color: #DDDDDD; padding: 20px;">
⚠️ The following post confuses the Decorator Pattern with the Proxy Pattern.
While the structures of those Patterns are the same, they aim for different goals.
The Decorator adds functionality to the underlying object, whereas a Proxy controls access to it.
Therefor the usage of a cache is rather a Proxy than a Decorator.
</div>

<h2>The Decorator Pattern</h2>Class Diagram: <br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-5tWIyDICVvM/UTtSn3qThiI/AAAAAAAAAAg/AYI4tvgmpyA/s1600/decorator_pattern.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-5tWIyDICVvM/UTtSn3qThiI/AAAAAAAAAAg/AYI4tvgmpyA/s1600/decorator_pattern.png" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><br />Decorator Pattern is one of the most powerful Design Patterns, and its important to understand why. It allows you to add functionality to a Class without changing it. You use delegation instead of inheritance by just wrapping the existing Class in a "Suite" of your choice while the Interface stays the same. This way, you can even wrap a Class into multiple layers of Decorators where every Layer has its own and different purpose, and the Original Class even stays the same. Other than that the Layers are completely interchangeable and removable, because they all have the same Interface.<br />You can use your naked Object in the same manner as a decorated one with multiple Layers, and the rest of the Application wont even notice. Other components dont need to know whether a Class is decorated or not, because the only thing they care about is the Interface. The following Graphic should clear things up:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-gQHsPM_WUD0/UTtTP8ndLhI/AAAAAAAAAAo/33AtWE7cvNM/s1600/cache_decorator_steps.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-gQHsPM_WUD0/UTtTP8ndLhI/AAAAAAAAAAo/33AtWE7cvNM/s1600/cache_decorator_steps.png" /></a></div>Just follow the Steps:<br />In the first example there is no Decorator. So SomeClass directly speaks to BookService<br />In the second example there is a single Decorator. Therefore the following steps apply<br /><ol><li>SomeClass calls SomeDecoratorA.</li><li>SomeDecoratorA delegates the call to the real BookService. The Decorator could even manipulate the call in this step.</li><li>BookService returns a result. SomeDecoratorA now holds the result, and may manipulate it.</li><li>Finally, SomeDecoratorA hands the result over to the original caller SomeClass.</li></ol>In the third example, there are even 2 Nested Decorators. Since every Decorator speaks the Interface of the BookService Class you can wrap an infinite amount of Decorators upon.<br /><br /><h3>Usage Examples</h3>Most examples in Books and online Guides describe the Decorator Pattern used by some Graphic related stuff. You would have a normal line, and a line decorated with a shadow. Another example would be a Window in a GUI where you vary Decorators that add different kinds of styles (e.g. different Colors).<br /><br />But its important to understand, that Decorators are not intended to just make Styling more dynamic. It is just one way to use them. Instead, there are many more great use cases for Decorators and i will show you an example applying cache functionality.<br /><br /><h3>Applying Cache with Decorator Pattern</h3>Class Diagram:<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-QeqCL_o0nQo/UTtV93LNgLI/AAAAAAAAAAw/SAP7zX3arnE/s1600/decorator_cache.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-QeqCL_o0nQo/UTtV93LNgLI/AAAAAAAAAAw/SAP7zX3arnE/s1600/decorator_cache.png" /></a></div><br />As you can see i am adding a BookServiceCacheDecorator that holds a Cache Component which temporarily stores a List of Books. The BookServiceCacheDecorator in the first place asks the Cache if there is a result available. If thats true, the decorator will use the cached result. Otherwise it will fetch the Result of the BookService itself, and store the Result in the Cache for later use.<br /><br />I start with the BookService Interface,<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">interface</span> <span style="color: #b00060; font-weight: bold;">BookService</span> <span style="color: #303030;">{</span><br />    <span style="color: green; font-weight: bold;">public</span> List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> findAll<span style="color: #303030;">();</span><br /><span style="color: #303030;">}</span><br /></pre></td></tr></tbody></table></div><br />and its prime implementation.<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">class</span> <span style="color: #b00060; font-weight: bold;">BookServiceImpl</span> <span style="color: green; font-weight: bold;">implements</span> BookService <span style="color: #303030;">{</span><br /><br />    <span style="color: #505050; font-weight: bold;">@Override</span><br />    <span style="color: green; font-weight: bold;">public</span> List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> findAll<span style="color: #303030;">()</span> <span style="color: #303030;">{</span><br />        System<span style="color: #303030;">.</span><span style="color: #0000c0;">out</span><span style="color: #303030;">.</span><span style="color: #0000c0;">println</span><span style="color: #303030;">(</span><span style="background-color: #fff0f0;">"load new data"</span><span style="color: #303030;">);</span><br />        List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> books <span style="color: #303030;">=</span> <span style="color: green; font-weight: bold;">new</span> ArrayList<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;();</span><br />        books<span style="color: #303030;">.</span><span style="color: #0000c0;">add</span><span style="color: #303030;">(</span><span style="color: green; font-weight: bold;">new</span> Book<span style="color: #303030;">(</span><span style="background-color: #fff0f0;">"BookA"</span><span style="color: #303030;">));</span><br />        books<span style="color: #303030;">.</span><span style="color: #0000c0;">add</span><span style="color: #303030;">(</span><span style="color: green; font-weight: bold;">new</span> Book<span style="color: #303030;">(</span><span style="background-color: #fff0f0;">"BookB"</span><span style="color: #303030;">));</span><br />        books<span style="color: #303030;">.</span><span style="color: #0000c0;">add</span><span style="color: #303030;">(</span><span style="color: green; font-weight: bold;">new</span> Book<span style="color: #303030;">(</span><span style="background-color: #fff0f0;">"BookC"</span><span style="color: #303030;">));</span><br />        <span style="color: green; font-weight: bold;">return</span> books<span style="color: #303030;">;</span><br />    <span style="color: #303030;">}</span><br /><span style="color: #303030;">}</span><br /></pre></td></tr></tbody></table></div><br />Here is the Code of the Cache Class. In this example it's caching forever, but thats alright.<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">class</span> <span style="color: #b00060; font-weight: bold;">Cache</span> <span style="color: #303030;">{</span><br /><br />    <span style="color: green; font-weight: bold;">private</span> List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> storage<span style="color: #303030;">;</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> <span style="color: #303090; font-weight: bold;">void</span> <span style="color: #0060b0; font-weight: bold;">save</span><span style="color: #303030;">(</span>List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> books<span style="color: #303030;">){</span><br />        <span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">.</span><span style="color: #0000c0;">storage</span> <span style="color: #303030;">=</span> books<span style="color: #303030;">;</span><br />    <span style="color: #303030;">}</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> <span style="color: #303090; font-weight: bold;">boolean</span> <span style="color: #0060b0; font-weight: bold;">hasResult</span><span style="color: #303030;">(){</span><br />        <span style="color: green; font-weight: bold;">if</span><span style="color: #303030;">(</span>storage <span style="color: #303030;">!=</span> <span style="color: green; font-weight: bold;">null</span><span style="color: #303030;">){</span><br />            <span style="color: green; font-weight: bold;">return</span> <span style="color: green; font-weight: bold;">true</span><span style="color: #303030;">;</span><br />        <span style="color: #303030;">}</span><br /><br />        <span style="color: green; font-weight: bold;">return</span> <span style="color: green; font-weight: bold;">false</span><span style="color: #303030;">;</span><br />    <span style="color: #303030;">}</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> load<span style="color: #303030;">(){</span><br />        System<span style="color: #303030;">.</span><span style="color: #0000c0;">out</span><span style="color: #303030;">.</span><span style="color: #0000c0;">println</span><span style="color: #303030;">(</span><span style="background-color: #fff0f0;">"load from cache"</span><span style="color: #303030;">);</span><br />        <span style="color: green; font-weight: bold;">return</span> storage<span style="color: #303030;">;</span><br />    <span style="color: #303030;">}</span><br /><span style="color: #303030;">}</span><br /></pre></td></tr></tbody></table></div><br />Now lets continue with the Decorator Base Class. It has a preemtive Constructor to hand over the decorated Object.<br /><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">abstract</span> <span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">class</span> <span style="color: #b00060; font-weight: bold;">BookServiceDecorator</span> <span style="color: green; font-weight: bold;">implements</span> BookService<span style="color: #303030;">{</span><br /><br />    <span style="color: green; font-weight: bold;">protected</span> BookService decorated<span style="color: #303030;">;</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> <span style="color: #0060b0; font-weight: bold;">BookServiceDecorator</span><span style="color: #303030;">(</span>BookService decorated<span style="color: #303030;">){</span><br />        <span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">.</span><span style="color: #0000c0;">decorated</span> <span style="color: #303030;">=</span> decorated<span style="color: #303030;">;</span><br />    <span style="color: #303030;">}</span><br /><span style="color: #303030;">}</span><br /></pre></td></tr></tbody></table></div><br />And finally the CacheDecorator. It Checks the Cache before calling BookServiceImpl.<br /><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;"> 1<br /> 2<br /> 3<br /> 4<br /> 5<br /> 6<br /> 7<br /> 8<br /> 9<br />10<br />11<br />12<br />13<br />14<br />15<br />16<br />17<br />18<br />19<br />20<br />21<br />22<br />23</pre></td><td><pre style="line-height: 125%; margin: 0;"><span style="color: green; font-weight: bold;">public</span> <span style="color: green; font-weight: bold;">class</span> <span style="color: #b00060; font-weight: bold;">BookServiceCacheDecorator</span> <span style="color: green; font-weight: bold;">extends</span> BookServiceDecorator <span style="color: #303030;">{</span><br /><br />    <span style="color: green; font-weight: bold;">private</span> Cache cache<span style="color: #303030;">;</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> <span style="color: #0060b0; font-weight: bold;">BookServiceCacheDecorator</span><span style="color: #303030;">(</span>BookService decorated<span style="color: #303030;">)</span> <span style="color: #303030;">{</span><br />        <span style="color: green; font-weight: bold;">super</span><span style="color: #303030;">(</span>decorated<span style="color: #303030;">);</span><br />    <span style="color: #303030;">}</span><br /><br />    <span style="color: green; font-weight: bold;">public</span> <span style="color: #0060b0; font-weight: bold;">BookServiceCacheDecorator</span><span style="color: #303030;">(</span>BookService decorated<span style="color: #303030;">,</span> Cache cache<span style="color: #303030;">)</span> <span style="color: #303030;">{</span><br />        <span style="color: green; font-weight: bold;">super</span><span style="color: #303030;">(</span>decorated<span style="color: #303030;">);</span><br />        <span style="color: green; font-weight: bold;">this</span><span style="color: #303030;">.</span><span style="color: #0000c0;">cache</span> <span style="color: #303030;">=</span> cache<span style="color: #303030;">;</span><br />    <span style="color: #303030;">}</span><br /><br />    <span style="color: #505050; font-weight: bold;">@Override</span><br />    <span style="color: green; font-weight: bold;">public</span> List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> findAll<span style="color: #303030;">()</span> <span style="color: #303030;">{</span><br />        <span style="color: green; font-weight: bold;">if</span><span style="color: #303030;">(</span>cache<span style="color: #303030;">.</span><span style="color: #0000c0;">hasResult</span><span style="color: #303030;">()){</span><br />            <span style="color: green; font-weight: bold;">return</span> cache<span style="color: #303030;">.</span><span style="color: #0000c0;">load</span><span style="color: #303030;">();</span><br />        <span style="color: #303030;">}</span><br />        List<span style="color: #303030;">&lt;</span>Book<span style="color: #303030;">&gt;</span> books <span style="color: #303030;">=</span> decorated<span style="color: #303030;">.</span><span style="color: #0000c0;">findAll</span><span style="color: #303030;">();</span><br />        cache<span style="color: #303030;">.</span><span style="color: #0000c0;">save</span><span style="color: #303030;">(</span>books<span style="color: #303030;">);</span><br />        <span style="color: green; font-weight: bold;">return</span> books<span style="color: #303030;">;</span><br />    <span style="color: #303030;">}</span><br /><span style="color: #303030;">}</span><br /></pre></td></tr></tbody></table></div><br />Now two different use cases. One without Decorator, and one with the Cache Decorator:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #ffffff; background: white; border-width: .1em .1em .1em .8em; border: solid gray; color: black; overflow: auto; padding: .2em .6em; width: auto;"><table><tbody><tr><td><pre style="line-height: 125%; margin: 0;">1<br />2<br />3<br />4<br />5<br />6<br />7<br />8<br />9</pre></td><td><pre style="line-height: 125%; margin: 0;">BookService bookService <span style="color: #303030;">=</span> <span style="color: green; font-weight: bold;">new</span> BookServiceImpl<span style="color: #303030;">();</span><br />bookService<span style="color: #303030;">.</span><span style="color: #0000c0;">findAll</span><span style="color: #303030;">();</span> <span style="color: grey;">// prints: load new data</span><br />bookService<span style="color: #303030;">.</span><span style="color: #0000c0;">findAll</span><span style="color: #303030;">();</span> <span style="color: grey;">// prints: load new data</span><br />bookService<span style="color: #303030;">.</span><span style="color: #0000c0;">findAll</span><span style="color: #303030;">();</span> <span style="color: grey;">// prints: load new data</span><br /><br />BookService cachedBookService <span style="color: #303030;">=</span> <span style="color: green; font-weight: bold;">new</span> BookServiceCacheDecorator<span style="color: #303030;">(</span><span style="color: green; font-weight: bold;">new</span> BookServiceImpl<span style="color: #303030;">(),</span> <span style="color: green; font-weight: bold;">new</span> Cache<span style="color: #303030;">());</span><br />cachedBookService<span style="color: #303030;">.</span><span style="color: #0000c0;">findAll</span><span style="color: #303030;">();</span> <span style="color: grey;">// prints: load new data</span><br />cachedBookService<span style="color: #303030;">.</span><span style="color: #0000c0;">findAll</span><span style="color: #303030;">();</span> <span style="color: grey;">// prints: load from cache</span><br />cachedBookService<span style="color: #303030;">.</span><span style="color: #0000c0;">findAll</span><span style="color: #303030;">();</span> <span style="color: grey;">// prints: load from cache</span><br /></pre></td></tr></tbody></table></div><br />Thats basically it. Just read the Code carefully. The final use cases should make clear how the Decorator applies functionality. Decorator pattern really helps you create a very modular Code in many circumstances. You should not be afraid of the additional Classes the Pattern depends on, since they are really not a big deal. The modularity gained easily outweighs them.
